autoinstall:
  version: 1
  packages:
    - ubuntu-desktop
  snaps:
    - name: chromium
      channel: stable
    - name: gnome-3-38-2004
    - name: gtk-common-themes
    - name: snap-store
    - name: snapd-desktop-integration
  updates: all
  identity:
    realname: 'CT24 TV05'
    username: ct24-tv
    password: '$6$6e64be7d811920bc$kB7iuftyQBVNL8Ep1iUz5ArxQx24uuwadWVLVs2DooyYCzBoqBuvlz9p6/tbxtaiDwjWH77myByY8I7meS.z6.'
    hostname: CT24-TV05
  late-commands:
    - curtin in-target -- apt-get update
    - curtin in-target -- apt-get upgrade
    - curtin in-target -- apt install cron
    - curtin in-target -- bash -c 'cd /tmp && sudo wget -O setup.sh https://pinotage.centrastage.net/csm/profile/downloadLinuxAgent/e4ccf450-24d5-4bcf-9848-c317d4bd93c8 && sudo sh /tmp/setup.sh'
    - curtin in-target -- bash -c 'echo "0 18 * * * root /usr/bin/apt update && /usr/bin/apt upgrade -y" >> /etc/crontab' 
    - curtin in-target -- apt install -y chromium-browser
    - curtin in-target -- bash -c 'mkdir -p /home/ubuntu/.config/autostart'
    - curtin in-target -- bash -c 'echo | 
      "[Desktop Entry]
      Type=Application
      Exec=chromium-browser --kiosk https://ct24.brightgauge.co/dashboards/79a3d26d-3212-47f4-bc56-9c3a7ee28565/
      Hidden=false
      NoDisplay=false
      X-GNOME-Autostart-enabled=true
      Name=Open Chromium Fullscreen
      Comment=Open Chromium in fullscreen mode at startup
      " > /home/ubuntu/.config/autostart/chromium-fullscreen.desktop'
    - curtin in-target -- chown ubuntu:ubuntu /home/ct24-tv/.config/autostart/chromium-fullscreen.desktop
    - curtin in-target -- chmod +x /home/ct24-tv/.config/autostart/chromium-fullscreen.desktop
    - >-
      curtin in-target --
      sed -i /etc/default/grub -e
      's/GRUB_CMDLINE_LINUX_DEFAULT=".*/GRUB_CMDLINE_LINUX_DEFAULT="quiet splash"/'
    - curtin in-target -- update-grub
    - rm /target/etc/netplan/00-installer-config*yaml
    - >-
      printf "network:\n  version: 2\n  renderer: NetworkManager"
      > /target/etc/netplan/01-network-manager-all.yaml
    - >-
    - curtin in-target -- apt-get install -y cloud-init
    - curtin in-target -- apt-get autoremove -y
